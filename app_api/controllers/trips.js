// Lawrence Arundel CS 465

// Sources:
// Codepen, codepen. (2021, June 30). Draw an X in CSS (close sign) - codepen. codepen., from https://codepen.io/subin/pen/aEbvBP 
// Compart, C. (2022, March 3). Find all unicode characters from hieroglyphs to dingbats â€“ unicode compart. https://www.compart.com/en/unicode/U+27. Retrieved April 29, 2023, from https://www.compart.com/en/unicode/U+2753 
// Emoji Combos, E. C. (2022, February 14). Emoji Combosbeta. Emoji Combos., from https://emojicombos.com/ 
// Express, E. (2022, February 12). Cookie-parser. Express cookie-parser middleware., from https://expressjs.com/en/resources/middleware/cookie-parser.html 
// Express, E. (2022, February 12). Middleware Morgan., Middleware Morgan., from https://expressjs.com/en/resources/middleware/morgan.html
// Fitzgerald, A. (2022, July 14). HTML tables: When to use them and how to make &amp; edit them. HubSpot Blog., from https://blog.hubspot.com/website/make-a-table-in-html#:~:text=To%20make%20a%20table%20in%20HTML%2C%20use%20the,tag%20defines%20the%20table%20header. 
// Forret, P. (2021, April 3). HTML character: right arrow. HTML character: right arrow Â· toolstud.io., from https://toolstud.io/web/charmap.php?encoded=larr 
// Forret, P. (2021, April 3). HTML character: left arrow. HTML character: left arrow Â· toolstud.io., from https://toolstud.io/web/charmap.php?encoded=rarr
// GeeksForGeeks, G. F. G. (2023, March 16). Express.js res.render() function. GeeksforGeeks., from https://www.geeksforgeeks.org/express-js-res-render-function/ 
// GeeksForGeeks, G. F. G. (2023, March 16). Express.js express.Router() Function. GeeksforGeeks., from https://www.geeksforgeeks.org/express-js-express-router-function/
// Holmes, S., &amp; Harber, C. (2019). Getting mean with Mongo, express, angular, and node. Manning. 
// Hotsymbol, H. (2020, November 13). House copy and Paste - Hotsymbol. Hotsymbol., from https://www.hotsymbol.com/symbol/house 
// IconScout, I. S. (2022, March 3). Free user circle icon - download in Glyph style. IconScout., from https://iconscout.com/icon/user-circle-3609976 
// IconScout, I. S. (2022, March 3). Free Mail Icon - download in Glyph style. IconScout., from https://iconscout.com/icons/mail-icon?price=free
// IconScout, I. S. (2022, March 3). Free Message Icon - download in Glyph style. IconScout., from https://iconscout.com/icon/chat-bubble-4398305
// IconScout, I. S. (2022, March 3). Free Question Mark Icon - download in Glyph style. IconScout., from https://iconscout.com/icon/help-2653303
// Megida, D. (2022, April 25). Module.exports â€“ how to export in node.js and JavaScript. freeCodeCamp.org., from https://www.freecodecamp.org/news/module-exports-how-to-export-in-node-js-and-javascript/#:~:text=module.exports%20is%20an%20object,with%20the%20require%20global%20method. 
// MIT, M. I. T. (2021, October 19). # introduction. Handlebars., from https://handlebarsjs.com/guide/ 
// MIT, M. I. T. (2021, October 19). # introduction. Handlebars., from https://handlebarsjs.com/guide/builtin-helpers.html#with 
// MongoDB, M. D. B. (2022, March 1). Connection String URI Format. Connection String URI Format - MongoDB Manual., from https://www.mongodb.com/docs/manual/reference/connection-string/ 
// MongoDB, M. D. B. (2022, February 11). Query on Embedded/Nested Documents - MongoDB Manual., from https://www.mongodb.com/docs/manual/tutorial/query-embedded-documents/ 
// Mongoose, M. (2022, May 11). Getting started. Mongoose v7.1.0: Getting Started., from https://mongoosejs.com/docs/ 
// Mozilla, M. (2022, February 1). Express tutorial part 4: Routes and controllers - learn web development: MDN. Learn web development | MDN., from https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes 
// Mozilla, M. (2022, February 1). Express/Node introduction., Express/Node introduction., from https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/Introduction
// Mozilla, M. (2022, February 1). Element: getElementsByClassName() method., from https://developer.mozilla.org/en-US/docs/Web/API/Element/getElementsByClassName
// Mozilla, M. (2022, February 1). Background., from https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag
// NPM, N. P. M. (2022, May 11). HTTP-errors. npm., from https://www.npmjs.com/package/http-errors 
// Philiapp, P. (2022, February 2). X mark letters. X mark symbols - âœ–., from https://www.piliapp.com/symbol/x-mark/ 
// Phuoc, N. H. (2021, September 4). Loop over a nodelist - HTML dom. 1LOC., from https://htmldom.dev/loop-over-a-nodelist/ 
// Sam, B. (2022, July 22). How to highlight-change color of selected row in table. OutSystems., from https://www.outsystems.com/forums/discussion/80134/how-to-highlight-change-color-of-selected-row-in-table/ 
// Scherer, M. (2023, April 3). ðŸ”ï¸Ž (text style) magnifying glass tilted left : U+1F50D fe0e unicode information. EmojiAll., from https://www.emojiall.com/en/code/1F50D-FE0E 
// SNHU, S. N. H. U. (2023, May 1). CS 465 Full Stack Guide., from https://learn.snhu.edu/d2l/home 
// SNHU, S. N. H. U. (2023, May 1). CS 465 Travlr Getaways Wireframe., from https://learn.snhu.edu/content/enforced/1313027-CS-465-T5558-OL-TRAD-UG.23EW5/course_documents/CS%20465%20Travlr%20Getaways%20Wireframe.pdf?ou=1313027
// SNHU Media, S. N. H. U. M. (2020, March 3). CS 465: MVC Routing. YouTube., from https://www.youtube.com/watch?v=aNIrBEpc1cM&amp;ab_channel=SNHUMedia 
// SNHU Media, S. N. H. U. M. (2020, March 3). CS 465: Dynamic view rendering. YouTube., from https://www.youtube.com/watch?v=vXr5FVuVAyg&amp;ab_channel=SNHUMedia 
// Softel, S. (2021, March 5). Simple Image Placeholder Service. Placeholder Service., from https://placehold.jp/en.html 
// W3Schools, W. S. (2021, May 4). How to - tabs. How To Create Tabs., from https://www.w3schools.com/howto/howto_js_tabs.asp 
// W3Schools, W. S. (2021, May 4). JavaScript HTML DOM EventListener., from https://www.w3schools.com/js/js_htmldom_eventlistener.asp#:~:text=The%20addEventListener()%20method%20attaches,event%20handlers%20to%20one%20element.
// W3Schools, W. S. (2021, May 4). GetElementByID()., from https://www.w3schools.com/jsref/met_document_getelementbyid.asp#:~:text=Definition%20and%20Usage,or%20edit%20an%20HTML%20element.
// W3Schools, W. S. (2021, May 4). HTML DOM Document querySelectorAll()., from https://www.w3schools.com/jsref/met_document_queryselectorall.asp#:~:text=Definition%20and%20Usage,the%20selector(s)%20is%20invalid
// W3Schools, W. S. (2021, May 4). HTML DOM Element classList., from https://www.w3schools.com/jsref/prop_element_classlist.asp
// W3Schools, W. S. (2021, May 4). Style display Property., from https://www.w3schools.com/jsref/prop_style_display.asp
// W3Schools, W. S. (2021, May 4). HTML DOM Element className., from https://www.w3schools.com/jsref/prop_html_classname.asp
// W3Schools, W. S. (2021, May 4). JavaScript Window Location., from https://www.w3schools.com/js/js_window_location.asp
// W3Schools, W. S. (2021, May 4). stopPropagation() Event Method., from https://www.w3schools.com/jsref/event_stoppropagation.asp#:~:text=Definition%20and%20Usage,capturing%20down%20to%20child%20elements.

// opens the required connection to run mongoose within the environment (Mongoose, 2022, p.  1)
const mongoose = require('mongoose');

// variable used to construct the model named trips (SNHU, 2023, p. 1)
const Model = mongoose.model('trips');

// GET: /trips - lists all the trips  (SNHU, 2023, p. 1)
const tripsList = async (req, res) => {
    Model
        .find({}) // empty filter for all
        .exec((err, trips) => {

            // condition that states if no trip exists, then return the status 404 and output the message in json accordingly,
            // else if there exists an error within the execution, return 404 and output the error message, 
            // else return status 200 and set the trips variable to json format (SNHU, 2023, p. 1)
            if (!trips) {
                return res
                    .status(404)
                    .json({ "message": "trips not found" });
            } else if (err) {
                return res
                    .status(404)
                    .json(err);
            } else {
                return res
                    .status(200)
                    .json(trips);
            }
        });
};
 
// GET: /trips/:tripCode - returns a single trip (SNHU, 2023, p. 1)
const tripsFindCode = async (req, res) => {
    Model
        .findOne({ 'code': req.params.code })
        .exec((err, trips) => {

            // condition that states if no trip exists, then return the status 404 and output the message in json accordingly,
            // else if there exists an error within the execution, return 404 and output the error message, 
            // else return status 200 and set the trips variable to json format (SNHU, 2023, p. 1)
            if (!trips) {
                return res
                    .status(404)
                    .json({ "message": "trip not found" });
            }
            else if (err) {
                return res
                    .status(404)
                    .json(err);
            }
            else {
                return res
                    .status(200)
                    .json(trips);
            }
        });
};

// DELETE: /trips/:tripCode - deletes a single trip by code (SNHU, 2023, p. 1)
const tripsDeleteByCode = async (req, res) => {
    Model
        .deleteOne({ 'code': req.params.code })
        .exec((err, trips) => {

            // condition that states if no trip exists, then return the status 404 and output the message in json accordingly,
            // else if there exists an error within the execution, return 404 and output the error message, 
            // else return status 200 and set the trips variable to json format (SNHU, 2023, p. 1)
            if (!trips) {
                return res
                    .status(404)
                    .json({ "message": "trip not found" });
            }
            else if (err) {
                return res
                    .status(404)
                    .json(err);
            }
            else {
                return res
                    .status(200)
                    .json(trips);
            }
        });
};

// statement used to extract various properties of the Model to create new instances of add trip function within application (SNHU, 2023, p. 1)
const tripsAddTrip = async (req, res) => {
    Model
        .create({
            _id: new mongoose.Types.ObjectId(),
            code: req.body.code, // code from request body (SNHU, 2023, p. 1)
            name: req.body.name, // name from request body (SNHU, 2023, p. 1)
            length: req.body.length, // length of time from request body (SNHU, 2023, p. 1)
            start: req.body.start, // start date from request body (SNHU, 2023, p. 1)
            resort: req.body.resort, // resort name from request body (SNHU, 2023, p. 1)
            perPerson: req.body.perPerson, // price per person from request body (SNHU, 2023, p. 1)
            image: req.body.image, // image file from request body (SNHU, 2023, p. 1)
            description: req.body.description // description from request body (SNHU, 2023, p. 1)
        }, (err, trip) => {
            if (err) {
                return res
                    .status(400) // bad request, invalid content (SNHU, 2023, p. 1)
                    .json(err);
            } else {
                return res
                    .status(201) // created (SNHU, 2023, p. 1)
                    .json(trip);
            }
        });
}

// statement used to update trip which requires proper implementation of request body applying to correct properties described below (SNHU, 2023, p. 1)
const tripsUpdateTrip = async (req, res) => {
    console.log(req.body);
    Model
        .findOneAndUpdate({ 'code': req.params.code }, {
            code: req.body.code, // updating code with request body value code (SNHU, 2023, p. 1)
            name: req.body.name, // updating name with request body value name (SNHU, 2023, p. 1)
            length: req.body.length, // updating length of time with request body length of time (SNHU, 2023, p. 1)
            start: req.body.start, // updating start time with request body start time (SNHU, 2023, p. 1)
            resort: req.body.resort, // updating resort name with request body resort (SNHU, 2023, p. 1)
            perPerson: req.body.perPerson, // updating price per person with request body (SNHU, 2023, p. 1)
            image: req.body.image, // updating image name with request body (SNHU, 2023, p. 1)
            description: req.body.description // updating description name with request body (SNHU, 2023, p. 1)
        }, { new: true })
        .then(trip => {
            if (!trip) {
                return res
                    .status(404)
                    .send({
                        message: "Trip not found with code "
                            + req.params.code
                    });
            }
            res.send(trip);
        }).catch(err => {
            if (err.kind === 'ObjectId') {
                return res
                    .status(404)
                    .send({
                        message: "Trip not found with code "
                            + req.params.code
                    });
            }
            return res
                .status(500) // server error (SNHU, 2023, p. 1)
                .json(err);
        });
}

// object in the Node.js file that holds the exported values and functions from that module, in the case of it being the module exporting to the 
// tripsList and tripsFindByCode variables (Megida, 2022, p. 1);(SNHU, 2023, p. 1)
module.exports = {
    tripsList,
    tripsFindCode,
    tripsAddTrip,
    tripsUpdateTrip,
    tripsDeleteByCode
};

