// Lawrence Arundel CS 465

// Sources:
// Codepen, codepen. (2021, June 30). Draw an X in CSS (close sign) - codepen. codepen., from https://codepen.io/subin/pen/aEbvBP 
// Compart, C. (2022, March 3). Find all unicode characters from hieroglyphs to dingbats â€“ unicode compart. https://www.compart.com/en/unicode/U+27. Retrieved April 29, 2023, from https://www.compart.com/en/unicode/U+2753 
// Emoji Combos, E. C. (2022, February 14). Emoji Combosbeta. Emoji Combos., from https://emojicombos.com/ 
// Express, E. (2022, February 12). Cookie-parser. Express cookie-parser middleware., from https://expressjs.com/en/resources/middleware/cookie-parser.html 
// Express, E. (2022, February 12). Middleware Morgan., Middleware Morgan., from https://expressjs.com/en/resources/middleware/morgan.html
// Fitzgerald, A. (2022, July 14). HTML tables: When to use them and how to make &amp; edit them. HubSpot Blog., from https://blog.hubspot.com/website/make-a-table-in-html#:~:text=To%20make%20a%20table%20in%20HTML%2C%20use%20the,tag%20defines%20the%20table%20header. 
// Forret, P. (2021, April 3). HTML character: right arrow. HTML character: right arrow Â· toolstud.io., from https://toolstud.io/web/charmap.php?encoded=larr 
// Forret, P. (2021, April 3). HTML character: left arrow. HTML character: left arrow Â· toolstud.io., from https://toolstud.io/web/charmap.php?encoded=rarr
// GeeksForGeeks, G. F. G. (2023, March 16). Express.js res.render() function. GeeksforGeeks., from https://www.geeksforgeeks.org/express-js-res-render-function/ 
// GeeksForGeeks, G. F. G. (2023, March 16). Express.js express.Router() Function. GeeksforGeeks., from https://www.geeksforgeeks.org/express-js-express-router-function/
// Holmes, S., &amp; Harber, C. (2019). Getting mean with Mongo, express, angular, and node. Manning. 
// Hotsymbol, H. (2020, November 13). House copy and Paste - Hotsymbol. Hotsymbol., from https://www.hotsymbol.com/symbol/house 
// IconScout, I. S. (2022, March 3). Free user circle icon - download in Glyph style. IconScout., from https://iconscout.com/icon/user-circle-3609976 
// IconScout, I. S. (2022, March 3). Free Mail Icon - download in Glyph style. IconScout., from https://iconscout.com/icons/mail-icon?price=free
// IconScout, I. S. (2022, March 3). Free Message Icon - download in Glyph style. IconScout., from https://iconscout.com/icon/chat-bubble-4398305
// IconScout, I. S. (2022, March 3). Free Question Mark Icon - download in Glyph style. IconScout., from https://iconscout.com/icon/help-2653303
// Megida, D. (2022, April 25). Module.exports â€“ how to export in node.js and JavaScript. freeCodeCamp.org., from https://www.freecodecamp.org/news/module-exports-how-to-export-in-node-js-and-javascript/#:~:text=module.exports%20is%20an%20object,with%20the%20require%20global%20method. 
// MIT, M. I. T. (2021, October 19). # introduction. Handlebars., from https://handlebarsjs.com/guide/ 
// MIT, M. I. T. (2021, October 19). # introduction. Handlebars., from https://handlebarsjs.com/guide/builtin-helpers.html#with 
// MongoDB, M. D. B. (2022, March 1). Connection String URI Format. Connection String URI Format - MongoDB Manual., from https://www.mongodb.com/docs/manual/reference/connection-string/ 
// MongoDB, M. D. B. (2022, February 11). Query on Embedded/Nested Documents - MongoDB Manual., from https://www.mongodb.com/docs/manual/tutorial/query-embedded-documents/ 
// Mongoose, M. (2022, May 11). Getting started. Mongoose v7.1.0: Getting Started., from https://mongoosejs.com/docs/ 
// Mozilla, M. (2022, February 1). Express tutorial part 4: Routes and controllers - learn web development: MDN. Learn web development | MDN., from https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes 
// Mozilla, M. (2022, February 1). Express/Node introduction., Express/Node introduction., from https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/Introduction
// Mozilla, M. (2022, February 1). Element: getElementsByClassName() method., from https://developer.mozilla.org/en-US/docs/Web/API/Element/getElementsByClassName
// Mozilla, M. (2022, February 1). Background., from https://developer.mozilla.org/en-US/docs/Web/HTML/Viewport_meta_tag
// NPM, N. P. M. (2022, May 11). HTTP-errors. npm., from https://www.npmjs.com/package/http-errors 
// Philiapp, P. (2022, February 2). X mark letters. X mark symbols - âœ–., from https://www.piliapp.com/symbol/x-mark/ 
// Phuoc, N. H. (2021, September 4). Loop over a nodelist - HTML dom. 1LOC., from https://htmldom.dev/loop-over-a-nodelist/ 
// Sam, B. (2022, July 22). How to highlight-change color of selected row in table. OutSystems., from https://www.outsystems.com/forums/discussion/80134/how-to-highlight-change-color-of-selected-row-in-table/ 
// Scherer, M. (2023, April 3). ðŸ”ï¸Ž (text style) magnifying glass tilted left : U+1F50D fe0e unicode information. EmojiAll., from https://www.emojiall.com/en/code/1F50D-FE0E 
// SNHU, S. N. H. U. (2023, May 1). CS 465 Full Stack Guide., from https://learn.snhu.edu/d2l/home 
// SNHU, S. N. H. U. (2023, May 1). CS 465 Travlr Getaways Wireframe., from https://learn.snhu.edu/content/enforced/1313027-CS-465-T5558-OL-TRAD-UG.23EW5/course_documents/CS%20465%20Travlr%20Getaways%20Wireframe.pdf?ou=1313027
// SNHU Media, S. N. H. U. M. (2020, March 3). CS 465: MVC Routing. YouTube., from https://www.youtube.com/watch?v=aNIrBEpc1cM&amp;ab_channel=SNHUMedia 
// SNHU Media, S. N. H. U. M. (2020, March 3). CS 465: Dynamic view rendering. YouTube., from https://www.youtube.com/watch?v=vXr5FVuVAyg&amp;ab_channel=SNHUMedia 
// Softel, S. (2021, March 5). Simple Image Placeholder Service. Placeholder Service., from https://placehold.jp/en.html 
// W3Schools, W. S. (2021, May 4). How to - tabs. How To Create Tabs., from https://www.w3schools.com/howto/howto_js_tabs.asp 
// W3Schools, W. S. (2021, May 4). JavaScript HTML DOM EventListener., from https://www.w3schools.com/js/js_htmldom_eventlistener.asp#:~:text=The%20addEventListener()%20method%20attaches,event%20handlers%20to%20one%20element.
// W3Schools, W. S. (2021, May 4). GetElementByID()., from https://www.w3schools.com/jsref/met_document_getelementbyid.asp#:~:text=Definition%20and%20Usage,or%20edit%20an%20HTML%20element.
// W3Schools, W. S. (2021, May 4). HTML DOM Document querySelectorAll()., from https://www.w3schools.com/jsref/met_document_queryselectorall.asp#:~:text=Definition%20and%20Usage,the%20selector(s)%20is%20invalid
// W3Schools, W. S. (2021, May 4). HTML DOM Element classList., from https://www.w3schools.com/jsref/prop_element_classlist.asp
// W3Schools, W. S. (2021, May 4). Style display Property., from https://www.w3schools.com/jsref/prop_style_display.asp
// W3Schools, W. S. (2021, May 4). HTML DOM Element className., from https://www.w3schools.com/jsref/prop_html_classname.asp
// W3Schools, W. S. (2021, May 4). JavaScript Window Location., from https://www.w3schools.com/js/js_window_location.asp
// W3Schools, W. S. (2021, May 4). stopPropagation() Event Method., from https://www.w3schools.com/jsref/event_stoppropagation.asp#:~:text=Definition%20and%20Usage,capturing%20down%20to%20child%20elements.

// requirement used for the dovenv configuration within application (SNHU, 2023, p. 1)
require('dotenv').config();

// create/import HTTP errors for Express, Koa, Connect, etc. throughout the application (NPM, 2022, p. 1)
const createError = require('http-errors');

// create/import HTTP errors for Express, Koa, Connect, etc. throughout the application (NPM, 2022, p. 1)
const express = require('express');

// create/import HTTP errors and path requirements for Express, Koa, Connect, etc. throughout the application (NPM, 2022, p. 1)
const path = require('path');

// create/import a new cookie parser middleware function using the given secret and options required within the application (Express, 2022, p. 1)
const cookieParser = require('cookie-parser');

// create/import http request logger middleware for node.js to create a new morgan logger using the given format and options within application (Express, 2022, p. 1)
const logger = require('morgan');

// create/import HTTP errors for Express, Koa, Connect, etc. throughout the application (NPM, 2022, p. 1)
const hbs = require('hbs');

// passport requirement within application (SNHU, 2023, p. 1)
const passport = require('passport');

// triggers the database connection and mongoose schema models to be loaded within the application (SNHU, 2023, p. 1)
require('./app_api/models/db');

// triggers the passport connection to be loaded within the application (SNHU, 2023, p. 1)
require('./app_api/config/passport');

// cors policy requirement to override the pre-built policies within application (SNHU, 2023, p. 1)
var cors = require('cors');

// index router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const indexRouter = require('./app_server/routes/index');

// user router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const usersRouter = require('./app_server/routes/users');

// travel router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const travelRouter = require('./app_server/routes/traveler');

// admin router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const adminRouter = require('./app_server/routes/admin');

// checkout router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const checkoutRouter = require('./app_server/routes/checkout');

// login router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const loginRouter = require('./app_server/routes/login');

// news router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const newsRouter = require('./app_server/routes/news');

// reservation router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const reservationRouter = require('./app_server/routes/travel');

// signup router required for the middleware chain to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const signupRouter = require('./app_server/routes/signup');

// api router required to direct proper responses within Node.js framework (Mozilla, 2022, p. 1)
const apiRouter = require('./app_api/routes/index');

// function that allows application to access the properties and functions within the Express framework (Mozilla, 2022, p. 1)
const app = express();

// engine setup within the application provided (SNHU, 2023, p. 1)
app.set('views', path.join(__dirname, 'app_server', 'views'));

// register handlebars partials (NPM, 2021, p. 1)
hbs.registerPartials(path.join(__dirname, 'app_server', 'views/partials'));

// engine setup within the application provided (SNHU, 2023, p. 1)
app.set('view engine', 'hbs');

// statements that set the view engine and the view directory for the application that allows you to write HTML templates with embedded JavaScript (Mozilla, 2022, p. 1)
app.use(logger('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));
app.use(passport.initialize());
app.use(cors());

// allows for CORS within the application (SNHU, 2023, p. 1)
app.use('/api', (req, res, next) => {
  res.header('Access-Control-Allow-Origin', 'http://localhost:4200');
  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');
  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE');
  next();
});

// configures middleware for the application utilizing the index router variable (Mozilla, 2022, p. 1)
app.use('/', indexRouter);

// configures middleware for the application utilizing the user router variable (Mozilla, 2022, p. 1)
app.use('/users', usersRouter);

// configures middleware for the application utilizing the travel router variable (Mozilla, 2022, p. 1)
app.use('/travel', travelRouter);

// configures middleware for the application utilizing the admin router variable (Mozilla, 2022, p. 1)
app.use('/admin', adminRouter);

// configures middleware for the application utilizing the checkout router variable (Mozilla, 2022, p. 1)
app.use('/checkout', checkoutRouter);

// configures middleware for the application utilizing the login router variable (Mozilla, 2022, p. 1)
app.use('/login', loginRouter);

// configures middleware for the application utilizing the news router variable (Mozilla, 2022, p. 1)
app.use('/news', newsRouter);

// configures middleware for the application utilizing the reservation router variable (Mozilla, 2022, p. 1)
app.use('/reservations', reservationRouter);

// configures middleware for the application utilizing the signup router variable (Mozilla, 2022, p. 1)
app.use('/signup', signupRouter);

// configures middleware for the application utilizing the users router variable (Mozilla, 2022, p. 1)
app.use('/users', usersRouter);

// configures middleware for the application utilizing the api router variable (Mozilla, 2022, p. 1)
app.use('/api/trips', apiRouter);

// configures middleware for the application utilizing the api router variable (Mozilla, 2022, p. 1)
app.use('/api', apiRouter);

// configures middleware for the application utilizing the api router variable (Mozilla, 2022, p. 1)
app.use('/api', apiRouter);

// catches the 404 error message and forwards the error handler within the application (SNHU, 2023, p. 1)
app.use(function (req, res, next) {
  next(createError(404));
});

// error handler functions within the application (SNHU, 2023, p. 1)
app.use(function (err, req, res, next) {

  // sets the locals of the application, providing the error within the development (SNHU, 2023, p. 1)
  res.locals.message = err.message;
  res.locals.error = req.app.get('env') === 'development' ? err : {};

  // renders the error page within the application (SNHU, 2023, p. 1)
  res.status(err.status || 500);
  res.render('error');
});

// catch unauthorized error and create 401 error (SNHU, 2023, p. 1)
app.use((err, req, res, next) => {
  if (err.name === 'UnauthorizedError') {
    res
      .status(401)
      .json({ "message": err.name + ": " + err.message });
  }
});


// object in the Node.js file that holds the exported values and functions from that module, in the case of it being the module exporting to the app variable (Megida, 2022, p. 1);(SNHU, 2023, p. 1)
module.exports = app;
